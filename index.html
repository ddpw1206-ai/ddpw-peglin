<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게임 랜덤 뽑기 도우미</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; line-height: 1.4; }
    h2 { margin-top: 24px; }
    fieldset { margin-bottom: 16px; }
    button { margin: 4px 0; }
    .result-box { padding: 8px; border: 1px solid #ccc; margin-top: 8px; white-space: pre-line; }
    label { display: block; margin-top: 4px; }
    .result-value { font-weight: bold; color: #0066cc; font-size: 1.1em; }
    .result-item { margin: 4px 0; padding: 8px; background: #f0f8ff; border-left: 3px solid #0066cc; display: flex; align-items: center; justify-content: space-between; }
    .result-item-content { flex: 1; }
    .rarity-text { color: #8b4513; font-weight: 600; }
    input[type="number"] { width: 80px; margin-left: 4px; }
    .redraw-btn { margin-left: 8px; padding: 4px 8px; font-size: 0.9em; cursor: pointer; }
  </style>
</head>
<body>
  <h1>게임 랜덤 뽑기 도우미</h1>

  <!-- 공통: 랜덤 유틸 -->
  <script>
    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
  </script>

  <!-- 1단계: 캐릭터 / 난이도 -->
  <h2>1단계: 캐릭터 / 난이도</h2>
  <fieldset>
    <legend>캐릭터 & 난이도 뽑기</legend>

    <button onclick="drawCharacter()">캐릭터 뽑기 (1~4)</button>
    <div id="characterResult" class="result-box"></div>

    <label>
      최대 난이도 숫자:
      <input type="number" id="maxDifficulty" value="10" min="1" />
    </label>
    <button onclick="drawDifficulty()">난이도 뽑기 (1 ~ 최대)</button>
    <div id="difficultyResult" class="result-box"></div>
  </fieldset>

  <script>
    function drawCharacter() {
      const n = randInt(1, 4);
      const resultEl = document.getElementById('characterResult');
      resultEl.innerHTML = '선택된 캐릭터 번호: <span class="result-value">' + n + '</span>';
    }
    function drawDifficulty() {
      const max = parseInt(document.getElementById('maxDifficulty').value || '1', 10);
      const n = randInt(1, max);
      const resultEl = document.getElementById('difficultyResult');
      resultEl.innerHTML = '선택된 난이도: <span class="result-value">' + n + '</span> / 최대 ' + max;
    }
  </script>

  <!-- 2단계: 구슬 뽑기 -->
  <h2>2단계-1: 구슬 뽑기</h2>
  <fieldset>
    <legend>구슬 설정</legend>

    <label>
      최대 구슬 개수:
      <input type="number" id="maxBeads" value="5" min="1" />
    </label>
    <button onclick="decideBeadCount()">구슬 개수 뽑기</button>
    <div id="beadCountResult" class="result-box"></div>

    <label>
      구슬 중복 허용 (희귀도+번호 중복 가능):
      <input type="checkbox" id="beadAllowDuplicate" checked />
    </label>

    <button onclick="drawBeads()">구슬 도감에서 뽑기 시작</button>
    <div id="beadDrawResult" class="result-box"></div>

    <button onclick="drawBeadLevels()">구슬 레벨 뽑기 (1~3)</button>
    <div id="beadLevelResult" class="result-box"></div>
  </fieldset>

  <script>
    // 희귀도별 구슬 개수
    const beadRarityCounts = {
      1: 11, // 흔한
      2: 27, // 드문
      3: 14, // 희귀
      4: 6,  // 특수
      5: 54  // 다른 직업
    };

    // 희귀도 텍스트 매핑
    const beadRarityNames = {
      1: '흔한 구슬',
      2: '드문 구슬',
      3: '희귀한 구슬',
      4: '특수 구슬',
      5: '다른 직업의 구슬'
    };

    let beadCount = 0;
    let beads = []; // {rarity, index}
    let beadLevels = [];

    function decideBeadCount() {
      const max = parseInt(document.getElementById('maxBeads').value || '1', 10);
      beadCount = randInt(1, max);
      beads = [];
      beadLevels = [];
      const resultEl = document.getElementById('beadCountResult');
      resultEl.innerHTML = '뽑힌 구슬 개수: <span class="result-value">' + beadCount + '</span> (1~' + max + ')';
      document.getElementById('beadDrawResult').textContent = '';
      document.getElementById('beadLevelResult').textContent = '';
    }

    function drawSingleBead(allowDup) {
      // 희귀도 1~5 선택
      let rarity = randInt(1, 5);
      let total = beadRarityCounts[rarity] || 0;
      if (total <= 0) {
        // 도감에 아직 없음 -> 다시 뽑기
        return drawSingleBead(allowDup);
      }
      let idx = randInt(1, total);

      if (!allowDup) {
        // 같은 (희귀도, 번호) 조합이 이미 있으면 다시
        const exists = beads.some(b => b.rarity === rarity && b.index === idx);
        if (exists) return drawSingleBead(allowDup);
      }
      return { rarity, index: idx };
    }

    function drawBeads() {
      if (!beadCount || beadCount <= 0) {
        alert('먼저 구슬 개수를 뽑아주세요.');
        return;
      }
      const allowDup = document.getElementById('beadAllowDuplicate').checked;
      beads = [];
      for (let i = 0; i < beadCount; i++) {
        const bead = drawSingleBead(allowDup);
        beads.push(bead);
      }
      renderBeads();
    }

    // 공통 렌더링 함수
    function renderItems(items, resultElId, itemName, rarityNames, redrawFn) {
      const resultEl = document.getElementById(resultElId);
      if (!items.length) {
        resultEl.textContent = '아직 뽑힌 ' + itemName + '이 없습니다.';
        return;
      }
      let html = '<div style="margin-bottom: 8px;"><strong>총 <span class="result-value">' + items.length + '</span>개의 ' + itemName + '</strong></div>';
      items.forEach((item, i) => {
        const rarityName = rarityNames[item.rarity] || '알 수 없음';
        html += '<div class="result-item">';
        html += '<div class="result-item-content">';
        html += '<strong>' + (i + 1) + '번 ' + itemName + '</strong>: ';
        html += '희귀도 <span class="result-value">' + item.rarity + '</span> ';
        html += '(<span class="rarity-text">' + rarityName + '</span>), ';
        html += '번호 <span class="result-value">' + item.index + '</span>';
        html += '</div>';
        html += '<button class="redraw-btn" onclick="' + redrawFn + '(' + i + ')">다시 뽑기</button>';
        html += '</div>';
      });
      resultEl.innerHTML = html;
    }

    function redrawSingleBead(index) {
      if (index < 0 || index >= beads.length) return;
      const allowDup = document.getElementById('beadAllowDuplicate').checked;
      const newBead = drawSingleBead(allowDup);
      beads[index] = newBead;
      renderBeads();
    }

    function renderBeads() {
      renderItems(beads, 'beadDrawResult', '구슬', beadRarityNames, 'redrawSingleBead');
    }


    function drawBeadLevels() {
      if (!beads.length) {
        alert('먼저 구슬을 뽑아주세요.');
        return;
      }
      beadLevels = [];
      for (let i = 0; i < beads.length; i++) {
        beadLevels.push(randInt(1, 3));
      }
      let html = '';
      beadLevels.forEach((lv, i) => {
        html += '<div class="result-item">';
        html += '<strong>' + (i + 1) + '번 구슬</strong>의 레벨: <span class="result-value">' + lv + '</span>';
        html += '</div>';
      });
      document.getElementById('beadLevelResult').innerHTML = html;
    }
  </script>

  <!-- 2단계: 유물 뽑기 -->
  <h2>2단계-2: 유물 뽑기</h2>
  <fieldset>
    <legend>유물 설정</legend>

    <label>
      최대 유물 개수:
      <input type="number" id="maxRelics" value="5" min="1" />
    </label>
    <button onclick="decideRelicCount()">유물 개수 뽑기</button>
    <div id="relicCountResult" class="result-box"></div>

    <label>
      유물 희귀도 내 번호 중복 허용:
      <input type="checkbox" id="relicNumberAllowDuplicate" checked />
    </label>

    <button onclick="drawRelics()">유물 도감에서 뽑기 시작</button>
    <div id="relicDrawResult" class="result-box"></div>
  </fieldset>

  <script>
    // 희귀도별 유물 개수
    const relicRarityCounts = {
      1: 41, // 흔한 유물
      2: 48, // 희귀한 유물
      3: 21, // 보스 유물
      4: 9,  // 상점 유물
      5: 6,  // 시나리오 유물
      6: 48, // 다른 직업의 유물
      7: 11  // 비밀 유물
    };

    // 희귀도 텍스트 매핑
    const relicRarityNames = {
      1: '흔한 유물',
      2: '희귀한 유물',
      3: '보스 유물',
      4: '상점 유물',
      5: '시나리오 유물',
      6: '다른 직업의 유물',
      7: '비밀 유물'
    };

    let relicCount = 0;
    let relics = []; // {rarity, index}

    function decideRelicCount() {
      const max = parseInt(document.getElementById('maxRelics').value || '1', 10);
      relicCount = randInt(1, max);
      relics = [];
      const resultEl = document.getElementById('relicCountResult');
      resultEl.innerHTML = '뽑힌 유물 개수: <span class="result-value">' + relicCount + '</span> (1~' + max + ')';
      document.getElementById('relicDrawResult').textContent = '';
    }

    function drawSingleRelic(numberAllowDup) {
      let rarity = randInt(1, 7); // 1~7 (비밀 유물 포함)
      let total = relicRarityCounts[rarity] || 0;
      if (total <= 0) {
        // 도감에 아직 없음 -> 다시
        return drawSingleRelic(numberAllowDup);
      }
      let idx = randInt(1, total);

      // 전체 유물은 중복 불가
      const existsRelic = relics.some(r => r.rarity === rarity && r.index === idx);
      if (existsRelic) {
        // 질문 규칙상 "유물 자체 중복 불가"라서 무조건 다시
        return drawSingleRelic(numberAllowDup);
      }

      // 희귀도 내 번호 중복 허용 여부는, 이 규칙과 사실상 충돌하지만
      // 질문대로라면 "희귀도는 중복 가능, 번호 중복 여부만 옵션"이라
      // 번호 중복 허용이면 '같은 희귀도+번호를 새로 뽑는 것'은
      // 전체 유물 중복 규칙 때문에 결국 다시 뽑게 됨.
      // → 구현은 이미 existsRelic 체크로 처리된 상태.

      return { rarity, index: idx };
    }

    function drawRelics() {
      if (!relicCount || relicCount <= 0) {
        alert('먼저 유물 개수를 뽑아주세요.');
        return;
      }
      const numberAllowDup = document.getElementById('relicNumberAllowDuplicate').checked;
      relics = [];
      for (let i = 0; i < relicCount; i++) {
        const relic = drawSingleRelic(numberAllowDup);
        relics.push(relic);
      }
      renderRelics();
    }

    function redrawSingleRelic(index) {
      if (index < 0 || index >= relics.length) return;
      const numberAllowDup = document.getElementById('relicNumberAllowDuplicate').checked;
      const newRelic = drawSingleRelic(numberAllowDup);
      relics[index] = newRelic;
      renderRelics();
    }

    function renderRelics() {
      renderItems(relics, 'relicDrawResult', '유물', relicRarityNames, 'redrawSingleRelic');
    }
  </script>

  <!-- 3단계: 시드 뽑기 -->
  <h2>3단계: 시드 뽑기 (10자리)</h2>
  <fieldset>
    <legend>시드(1~9) 10번 뽑기</legend>
    <button onclick="drawSeed()">시드 뽑기</button>
    <div id="seedResult" class="result-box"></div>
  </fieldset>

  <script>
    function drawSeed() {
      let arr = [];
      for (let i = 0; i < 10; i++) {
        arr.push(randInt(1, 9));
      }
      const resultEl = document.getElementById('seedResult');
      resultEl.innerHTML = '시드 숫자 10개: <span class="result-value">' + arr.join('') + '</span><br>' +
        '(개별 값: ' + arr.map(n => '<span class="result-value">' + n + '</span>').join(', ') + ')';
    }
  </script>
</body>
</html>
